<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<!-- qtquick3dphysics-examples-charactercontroller.qdoc -->
  <meta name="description" content="Demonstrates the CharacterController type.">
  <title>Qt Quick 3D Physics - CharacterController Example | Qt Quick 3D Physics 6.6.0</title>
  <link rel="stylesheet" type="text/css" href="style/offline-simple.css" />
  <script type="text/javascript">
    document.getElementsByTagName("link").item(0).setAttribute("href", "style/offline.css");
    // loading style sheet breaks anchors that were jumped to before
    // so force jumping to anchor again
    setTimeout(function() {
        var anchor = location.hash;
        // need to jump to different anchor first (e.g. none)
        location.hash = "#";
        setTimeout(function() {
            location.hash = anchor;
        }, 0);
    }, 0);
  </script>
</head>
<body>
<div class="header" id="qtdocheader">
    <div class="main">
    <div class="main-rounded">
        <div class="navigationbar">
        <ul>
<li><a href="../qtdoc/index.html" translate="no">Qt 6.6</a></li>
<li><a href="qtquick3dphysics-index.html" translate="no">Qt Quick 3D Physics</a></li>
<li><a href="quick3dphysics-examples.html" translate="no">Qt Quick 3D Physics Examples and Tutorials</a></li>
<li>Qt Quick 3D Physics - CharacterController Example</li>
<li id="buildversion"><a href="qtquick3dphysics-index.html" translate="no">Qt Quick 3D Physics | Commercial or GPLv3</a></li>
    </ul>
    </div>
</div>
<div class="content">
<div class="line">
<div class="content mainContent">
<h1 class="title">Qt Quick 3D Physics - CharacterController Example</h1>
<pre class="qml" translate="no">
 <span class="comment">// Copyright (C) 2023 The Qt Company Ltd.</span>
 <span class="comment">// SPDX-License-Identifier: LicenseRef-Qt-Commercial OR BSD-3-Clause</span>
 import QtQuick
 import QtQuick3D

 <span class="type"><a href="../qtquick/qml-qtquick-item.html" translate="no">Item</a></span> {
     <span class="name">id</span>: <span class="name">root</span>

     property <span class="type"><a href="../qtqml/qml-real.html" translate="no">real</a></span> <span class="name">xSpeed</span>: <span class="number">0.1</span>
     property <span class="type"><a href="../qtqml/qml-real.html" translate="no">real</a></span> <span class="name">ySpeed</span>: <span class="number">0.1</span>

     property <span class="type"><a href="../qtqml/qml-bool.html" translate="no">bool</a></span> <span class="name">xInvert</span>: <span class="number">false</span>
     property <span class="type"><a href="../qtqml/qml-bool.html" translate="no">bool</a></span> <span class="name">yInvert</span>: <span class="number">true</span>

     property <span class="type"><a href="../qtqml/qml-bool.html" translate="no">bool</a></span> <span class="name">mouseEnabled</span>: <span class="number">true</span>
     property <span class="type"><a href="../qtqml/qml-bool.html" translate="no">bool</a></span> <span class="name">keysEnabled</span>: <span class="number">true</span>

     readonly property <span class="type"><a href="../qtqml/qml-bool.html" translate="no">bool</a></span> <span class="name">inputsNeedProcessing</span>: <span class="name">status</span>.<span class="name">useMouse</span>

     property <span class="type">alias</span> <span class="name">acceptedButtons</span>: <span class="name">dragHandler</span>.<span class="name">acceptedButtons</span>

     <span class="name">implicitWidth</span>: <span class="name">parent</span>.<span class="name">width</span>
     <span class="name">implicitHeight</span>: <span class="name">parent</span>.<span class="name">height</span>
     <span class="name">focus</span>: <span class="name">keysEnabled</span>

     property <span class="type"><a href="../qtqml/qml-bool.html" translate="no">bool</a></span> <span class="name">moveForwards</span>: <span class="number">false</span>
     property <span class="type"><a href="../qtqml/qml-bool.html" translate="no">bool</a></span> <span class="name">moveBackwards</span>: <span class="number">false</span>
     property <span class="type"><a href="../qtqml/qml-bool.html" translate="no">bool</a></span> <span class="name">moveLeft</span>: <span class="number">false</span>
     property <span class="type"><a href="../qtqml/qml-bool.html" translate="no">bool</a></span> <span class="name">moveRight</span>: <span class="number">false</span>
     property <span class="type"><a href="../qtqml/qml-bool.html" translate="no">bool</a></span> <span class="name">moveUp</span>: <span class="number">false</span>
     property <span class="type"><a href="../qtqml/qml-bool.html" translate="no">bool</a></span> <span class="name">moveDown</span>: <span class="number">false</span>

     property <span class="type"><a href="../qtquick/qml-vector2d.html" translate="no">vector2d</a></span> <span class="name">cameraRotation</span>: <span class="name">Qt</span>.<span class="name">vector2d</span>(<span class="number">0</span>, <span class="number">0</span>)

     property <span class="type"><a href="../qtqml/qml-bool.html" translate="no">bool</a></span> <span class="name">sprintActive</span>: <span class="number">false</span>
     property <span class="type"><a href="../qtqml/qml-bool.html" translate="no">bool</a></span> <span class="name">crouchActive</span>: <span class="number">false</span>

     <span class="type"><a href="../qtquick/qml-qtquick-draghandler.html" translate="no">DragHandler</a></span> {
         <span class="name">id</span>: <span class="name">dragHandler</span>
         <span class="name">target</span>: <span class="number">null</span>
         <span class="name">enabled</span>: <span class="name">mouseEnabled</span>
         <span class="name">onCentroidChanged</span>: {
             <span class="name">mouseMoved</span>(<span class="name">Qt</span>.<span class="name">vector2d</span>(<span class="name">centroid</span>.<span class="name">position</span>.<span class="name">x</span>, <span class="name">centroid</span>.<span class="name">position</span>.<span class="name">y</span>))
         }

         <span class="name">onActiveChanged</span>: {
             <span class="keyword">if</span> (<span class="name">active</span>)
                 <span class="name">mousePressed</span>(<span class="name">Qt</span>.<span class="name">vector2d</span>(<span class="name">centroid</span>.<span class="name">position</span>.<span class="name">x</span>,
                                          <span class="name">centroid</span>.<span class="name">position</span>.<span class="name">y</span>))
             <span class="keyword">else</span>
                 <span class="name">mouseReleased</span>(<span class="name">Qt</span>.<span class="name">vector2d</span>(<span class="name">centroid</span>.<span class="name">position</span>.<span class="name">x</span>,
                                           <span class="name">centroid</span>.<span class="name">position</span>.<span class="name">y</span>))
         }
     }

     <span class="type"><a href="../qtquick/qml-qtquick-taphandler.html" translate="no">TapHandler</a></span> {
         <span class="name">onTapped</span>: <span class="name">root</span>.<span class="name">forceActiveFocus</span>()
     }

     <span class="name">Keys</span>.onPressed: (<span class="keyword"></span>event) =&gt; { <span class="keyword">if</span> (<span class="name">keysEnabled</span>) <span class="name">handleKeyPress</span>(<span class="name">event</span>) }
     <span class="name">Keys</span>.onReleased: (<span class="keyword"></span>event) =&gt; { <span class="keyword">if</span> (<span class="name">keysEnabled</span>) <span class="name">handleKeyRelease</span>(<span class="name">event</span>) }

     <span class="keyword">function </span><span class="name">mousePressed</span>(newPos) {
         <span class="name">root</span>.<span class="name">forceActiveFocus</span>()
         <span class="name">status</span>.<span class="name">currentPos</span> <span class="operator">=</span> <span class="name">newPos</span>
         <span class="name">status</span>.<span class="name">lastPos</span> <span class="operator">=</span> <span class="name">newPos</span>
         <span class="name">status</span>.<span class="name">useMouse</span> <span class="operator">=</span> <span class="number">true</span>
     }

     <span class="keyword">function </span><span class="name">mouseReleased</span>(newPos) {
         <span class="name">status</span>.<span class="name">useMouse</span> <span class="operator">=</span> <span class="number">false</span>
     }

     <span class="keyword">function </span><span class="name">mouseMoved</span>(newPos) {
         <span class="name">status</span>.<span class="name">currentPos</span> <span class="operator">=</span> <span class="name">newPos</span>
     }

     <span class="keyword">function </span><span class="name">forwardPressed</span>() {
         <span class="name">moveForwards</span> <span class="operator">=</span> <span class="number">true</span>
         <span class="name">moveBackwards</span> <span class="operator">=</span> <span class="number">false</span>
     }

     <span class="keyword">function </span><span class="name">forwardReleased</span>() {
         <span class="name">moveForwards</span> <span class="operator">=</span> <span class="number">false</span>
     }

     <span class="keyword">function </span><span class="name">backPressed</span>() {
         <span class="name">moveBackwards</span> <span class="operator">=</span> <span class="number">true</span>
         <span class="name">moveForwards</span> <span class="operator">=</span> <span class="number">false</span>
     }

     <span class="keyword">function </span><span class="name">backReleased</span>() {
         <span class="name">moveBackwards</span> <span class="operator">=</span> <span class="number">false</span>
     }

     <span class="keyword">function </span><span class="name">rightPressed</span>() {
         <span class="name">moveRight</span> <span class="operator">=</span> <span class="number">true</span>
         <span class="name">moveLeft</span> <span class="operator">=</span> <span class="number">false</span>
     }

     <span class="keyword">function </span><span class="name">rightReleased</span>() {
         <span class="name">moveRight</span> <span class="operator">=</span> <span class="number">false</span>
     }

     <span class="keyword">function </span><span class="name">leftPressed</span>() {
         <span class="name">moveLeft</span> <span class="operator">=</span> <span class="number">true</span>
         <span class="name">moveRight</span> <span class="operator">=</span> <span class="number">false</span>
     }

     <span class="keyword">function </span><span class="name">leftReleased</span>() {
         <span class="name">moveLeft</span> <span class="operator">=</span> <span class="number">false</span>
     }

     <span class="keyword">function </span><span class="name">upPressed</span>() {
         <span class="name">moveUp</span> <span class="operator">=</span> <span class="number">true</span>
         <span class="name">moveDown</span> <span class="operator">=</span> <span class="number">false</span>
     }

     <span class="keyword">function </span><span class="name">upReleased</span>() {
         <span class="name">moveUp</span> <span class="operator">=</span> <span class="number">false</span>
     }

     <span class="keyword">function </span><span class="name">downPressed</span>() {
         <span class="name">moveDown</span> <span class="operator">=</span> <span class="number">true</span>
         <span class="name">moveUp</span> <span class="operator">=</span> <span class="number">false</span>
     }

     <span class="keyword">function </span><span class="name">downReleased</span>() {
         <span class="name">moveDown</span> <span class="operator">=</span> <span class="number">false</span>
     }

     <span class="keyword">function </span><span class="name">sprintPressed</span>() {
         <span class="name">sprintActive</span> <span class="operator">=</span> <span class="number">true</span>
         <span class="name">crouchActive</span> <span class="operator">=</span> <span class="number">false</span>
     }

     <span class="keyword">function </span><span class="name">sprintReleased</span>() {
         <span class="name">sprintActive</span> <span class="operator">=</span> <span class="number">false</span>
     }

     <span class="keyword">function </span><span class="name">sneakPressed</span>() {
         <span class="name">crouchActive</span> <span class="operator">=</span> <span class="number">true</span>
         <span class="name">sprintActive</span> <span class="operator">=</span> <span class="number">false</span>
     }

     <span class="keyword">function </span><span class="name">sneakReleased</span>() {
         <span class="name">crouchActive</span> <span class="operator">=</span> <span class="number">false</span>
     }

     <span class="keyword">function </span><span class="name">handleKeyPress</span>(event) {
         <span class="keyword">switch</span> (<span class="name">event</span>.<span class="name">key</span>) {
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_W</span>:
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_Up</span>:
             <span class="name">forwardPressed</span>()
             <span class="keyword">break</span>
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_S</span>:
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_Down</span>:
             <span class="name">backPressed</span>()
             <span class="keyword">break</span>
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_A</span>:
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_Left</span>:
             <span class="name">leftPressed</span>()
             <span class="keyword">break</span>
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_D</span>:
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_Right</span>:
             <span class="name">rightPressed</span>()
             <span class="keyword">break</span>
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_R</span>:
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_PageUp</span>:
             <span class="name">upPressed</span>()
             <span class="keyword">break</span>
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_F</span>:
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_PageDown</span>:
             <span class="name">downPressed</span>()
             <span class="keyword">break</span>
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_Shift</span>:
             <span class="name">sprintPressed</span>()
             <span class="keyword">break</span>
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_Control</span>:
             <span class="name">sneakPressed</span>()
             <span class="keyword">break</span>
         }
     }

     <span class="keyword">function </span><span class="name">handleKeyRelease</span>(event) {
         <span class="keyword">switch</span> (<span class="name">event</span>.<span class="name">key</span>) {
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_W</span>:
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_Up</span>:
             <span class="name">forwardReleased</span>()
             <span class="keyword">break</span>
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_S</span>:
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_Down</span>:
             <span class="name">backReleased</span>()
             <span class="keyword">break</span>
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_A</span>:
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_Left</span>:
             <span class="name">leftReleased</span>()
             <span class="keyword">break</span>
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_D</span>:
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_Right</span>:
             <span class="name">rightReleased</span>()
             <span class="keyword">break</span>
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_R</span>:
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_PageUp</span>:
             <span class="name">upReleased</span>()
             <span class="keyword">break</span>
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_F</span>:
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_PageDown</span>:
             <span class="name">downReleased</span>()
             <span class="keyword">break</span>
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_Shift</span>:
             <span class="name">sprintReleased</span>()
             <span class="keyword">break</span>
         <span class="keyword">case</span> <span class="name">Qt</span>.<span class="name">Key_Control</span>:
             <span class="name">sneakReleased</span>()
             <span class="keyword">break</span>
         }
     }

     <span class="type"><a href="../qtqml/qml-qtqml-timer.html" translate="no">Timer</a></span> {
         <span class="name">id</span>: <span class="name">updateTimer</span>
         <span class="name">interval</span>: <span class="number">16</span>
         <span class="name">repeat</span>: <span class="number">true</span>
         <span class="name">running</span>: <span class="name">root</span>.<span class="name">inputsNeedProcessing</span>
         <span class="name">onTriggered</span>: {
             <span class="name">processInputs</span>()
         }
     }

     <span class="keyword">function </span><span class="name">processInputs</span>() {
         <span class="keyword">if</span> (<span class="name">root</span>.<span class="name">inputsNeedProcessing</span>)
             <span class="name">status</span>.<span class="name">processInput</span>()
     }

     <span class="type"><a href="../qtqml/qml-qtqml-qtobject.html" translate="no">QtObject</a></span> {
         <span class="name">id</span>: <span class="name">status</span>

         property <span class="type"><a href="../qtqml/qml-bool.html" translate="no">bool</a></span> <span class="name">useMouse</span>: <span class="number">false</span>

         property <span class="type"><a href="../qtquick/qml-vector2d.html" translate="no">vector2d</a></span> <span class="name">lastPos</span>: <span class="name">Qt</span>.<span class="name">vector2d</span>(<span class="number">0</span>, <span class="number">0</span>)
         property <span class="type"><a href="../qtquick/qml-vector2d.html" translate="no">vector2d</a></span> <span class="name">currentPos</span>: <span class="name">Qt</span>.<span class="name">vector2d</span>(<span class="number">0</span>, <span class="number">0</span>)

         <span class="keyword">function </span><span class="name">processInput</span>() {
             <span class="keyword">if</span> (<span class="name">useMouse</span>) {
                 <span class="comment">// Get the delta</span>
                 var delta = <span class="name">Qt</span>.<span class="name">vector2d</span>(<span class="name">lastPos</span>.<span class="name">x</span> <span class="operator">-</span> <span class="name">currentPos</span>.<span class="name">x</span>,
                                         <span class="name">lastPos</span>.<span class="name">y</span> <span class="operator">-</span> <span class="name">currentPos</span>.<span class="name">y</span>)
                 <span class="comment">// rotate x</span>
                 var rotateX = <span class="name">delta</span>.<span class="name">x</span> <span class="operator">*</span> <span class="name">xSpeed</span>
                 <span class="keyword">if</span> (<span class="name">xInvert</span>)
                     <span class="name">rotateX</span> <span class="operator">=</span> -<span class="name">rotateX</span>
                 <span class="name">cameraRotation</span>.<span class="name">x</span> <span class="operator">+=</span> <span class="name">rotateX</span>

                 <span class="comment">// rotate y</span>
                 var rotateY = <span class="name">delta</span>.<span class="name">y</span> <span class="operator">*</span> -<span class="name">ySpeed</span>
                 <span class="keyword">if</span> (<span class="name">yInvert</span>)
                     <span class="name">rotateY</span> <span class="operator">=</span> -<span class="name">rotateY</span>
                 <span class="name">cameraRotation</span>.<span class="name">y</span> <span class="operator">+=</span> <span class="name">rotateY</span>
                 <span class="name">lastPos</span> <span class="operator">=</span> <span class="name">currentPos</span>
             }
         }
     }
 }
</pre>
