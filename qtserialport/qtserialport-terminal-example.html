<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<!-- terminal.qdoc -->
  <meta name="description" content="Shows how to use various features of QSerialPort.">
  <title>Serial Terminal | Qt Serial Port 6.6.2</title>
  <link rel="stylesheet" type="text/css" href="style/offline-simple.css" />
  <script type="text/javascript">
    document.getElementsByTagName("link").item(0).setAttribute("href", "style/offline.css");
    // loading style sheet breaks anchors that were jumped to before
    // so force jumping to anchor again
    setTimeout(function() {
        var anchor = location.hash;
        // need to jump to different anchor first (e.g. none)
        location.hash = "#";
        setTimeout(function() {
            location.hash = anchor;
        }, 0);
    }, 0);
  </script>
</head>
<body>
<div class="header" id="qtdocheader">
    <div class="main">
    <div class="main-rounded">
        <div class="navigationbar">
        <ul>
<li><a href="../qtdoc/index.html" translate="no">Qt 6.6</a></li>
<li><a href="qtserialport-index.html" translate="no">Qt Serial Port</a></li>
<li><a href="qtserialport-examples.html" translate="no">Qt Serial Port Examples</a></li>
<li>Serial Terminal</li>
<li id="buildversion"><a href="qtserialport-index.html" translate="no">Qt 6.6.2 Reference Documentation</a></li>
    </ul>
    </div>
</div>
<div class="content">
<div class="line">
<div class="content mainContent">
<div class="sidebar">
<div class="toc">
<h3 id="toc">Contents</h3>
<ul>
<li class="level2"><a href="#writing-data">Writing Data</a></li>
<li class="level2"><a href="#reading-data">Reading Data</a></li>
<li class="level1"><a href="#running-the-example">Running the Example</a></li>
</ul>
</div>
<div class="sidebar-content" id="sidebar-content"></div></div>
<h1 class="title">Serial Terminal</h1>
<!-- $$$terminal-brief -->
<p>Shows how to use various features of <a href="qserialport.html" translate="no">QSerialPort</a>.</p>
<!-- @@@terminal -->
<!-- $$$terminal-description -->
<div class="descr" id="details">
<p><i>Terminal</i> shows how to create a terminal for a simple serial interface by using <a href="qtserialport-index.html" translate="no">Qt Serial Port</a>.</p>
<p class="centerAlign"><img src="images/terminal-example.png" alt="" /></p><p>This example shows the main features of the <a href="qserialport.html" translate="no">QSerialPort</a> class, like configuration, I/O implementation and so forth. Also, the class <a href="qserialportinfo.html" translate="no">QSerialPortInfo</a> is invoked to display information about the serial ports available in the system.</p>
<p><a href="qserialport.html" translate="no">QSerialPort</a> supports two general programming approaches:</p>
<ul>
<li><b>The asynchronous (non-blocking) approach.</b> Operations are scheduled and performed when the control returns to Qt's event loop. <a href="qserialport.html" translate="no">QSerialPort</a> emits a signal when the operation is finished. For example, <a href="../qtcore/qiodevice.html#write" translate="no">QSerialPort::write</a>() returns immediately. When the data is sent to the serial port, <a href="qserialport.html" translate="no">QSerialPort</a> emits <a href="../qtcore/qiodevice.html#bytesWritten" translate="no">bytesWritten</a>().</li>
<li><b>The synchronous (blocking) approach.</b> In non-GUI and multithreaded applications, the <code translate="no">waitFor...()</code> functions can be called (i.e. <a href="qserialport.html#waitForReadyRead" translate="no">QSerialPort::waitForReadyRead</a>()) to suspend the calling thread until the operation has completed.</li>
</ul>
<p>In this example, the asynchronous approach is demonstrated. The <a href="qtserialport-blockingreceiver-example.html" translate="no">Blocking Receiver</a> example illustrates the synchronous approach.</p>
<p>Our example contains some GUI widgets:</p>
<ul>
<li><code translate="no">MainWindow</code> (<code translate="no">terminal/mainwindow.cpp</code>) - is the main application window that contains all the working logic for the serial port programming, including configuration, I/O processing and so forth, while inheriting the QMainWindow.</li>
<li><code translate="no">Console</code> (<code translate="no">terminal/console.cpp</code>) - is the central widget of the main window, displaying the transmitted or received data. The widget is derived from the QPlainTextEdit class.</li>
<li><code translate="no">SettingsDialog</code> (<code translate="no">terminal/settingsdialog.cpp</code>) - is a dialog for configuring the serial port, as well as for displaying the available serial ports and information about them.</li>
</ul>
<p>The serial port is instantiated in the <code translate="no">MainWindow</code> constructor. The main widget is passed as the parent, so the object deletion happens automatically according to the parent and child mechanism in Qt:</p>
<pre class="cpp" translate="no">
 MainWindow<span class="operator">::</span>MainWindow(<span class="type">QWidget</span> <span class="operator">*</span>parent) :
     <span class="type">QMainWindow</span>(parent)<span class="operator">,</span>
     m_ui(<span class="keyword">new</span> Ui<span class="operator">::</span>MainWindow)<span class="operator">,</span>
     m_serial(<span class="keyword">new</span> <span class="type"><a href="qserialport.html" translate="no">QSerialPort</a></span>(<span class="keyword">this</span>))
 {
     ...
</pre>
<p>This example demonstrates the following <a href="qserialport.html" translate="no">QSerialPort</a> signals:</p>
<ul>
<li><a href="../qtcore/qiodevice.html#readyRead" translate="no">readyRead</a>() - shows that new data has been received and hence available</li>
<li><a href="../qtcore/qiodevice.html#bytesWritten" translate="no">bytesWritten</a>() - used to check that all data was written successfully</li>
</ul>
<pre class="cpp" translate="no">
     ...
     connect(m_serial<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="qserialport.html" translate="no">QSerialPort</a></span><span class="operator">::</span>readyRead<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>MainWindow<span class="operator">::</span>readData);
     connect(m_serial<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="qserialport.html" translate="no">QSerialPort</a></span><span class="operator">::</span>bytesWritten<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>MainWindow<span class="operator">::</span>handleBytesWritten);
     ...
 }
</pre>
<p>Clicking on the <b>Connect</b> button invokes the <code translate="no">openSerialPort()</code> slot:</p>
<pre class="cpp" translate="no">
 <span class="type">void</span> MainWindow<span class="operator">::</span>openSerialPort()
 {
     <span class="keyword">const</span> SettingsDialog<span class="operator">::</span>Settings p <span class="operator">=</span> m_settings<span class="operator">-</span><span class="operator">&gt;</span>settings();
     m_serial<span class="operator">-</span><span class="operator">&gt;</span>setPortName(p<span class="operator">.</span>name);
     m_serial<span class="operator">-</span><span class="operator">&gt;</span>setBaudRate(p<span class="operator">.</span>baudRate);
     m_serial<span class="operator">-</span><span class="operator">&gt;</span>setDataBits(p<span class="operator">.</span>dataBits);
     m_serial<span class="operator">-</span><span class="operator">&gt;</span>setParity(p<span class="operator">.</span>parity);
     m_serial<span class="operator">-</span><span class="operator">&gt;</span>setStopBits(p<span class="operator">.</span>stopBits);
     m_serial<span class="operator">-</span><span class="operator">&gt;</span>setFlowControl(p<span class="operator">.</span>flowControl);
     <span class="keyword">if</span> (m_serial<span class="operator">-</span><span class="operator">&gt;</span>open(<span class="type"><a href="../qtcore/qiodevice.html" translate="no">QIODevice</a></span><span class="operator">::</span>ReadWrite)) {
         m_console<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">true</span>);
         m_console<span class="operator">-</span><span class="operator">&gt;</span>setLocalEchoEnabled(p<span class="operator">.</span>localEchoEnabled);
         m_ui<span class="operator">-</span><span class="operator">&gt;</span>actionConnect<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">false</span>);
         m_ui<span class="operator">-</span><span class="operator">&gt;</span>actionDisconnect<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">true</span>);
         m_ui<span class="operator">-</span><span class="operator">&gt;</span>actionConfigure<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">false</span>);
         showStatusMessage(tr(<span class="string">&quot;Connected to %1 : %2, %3, %4, %5, %6&quot;</span>)
                           <span class="operator">.</span>arg(p<span class="operator">.</span>name<span class="operator">,</span> p<span class="operator">.</span>stringBaudRate<span class="operator">,</span> p<span class="operator">.</span>stringDataBits<span class="operator">,</span>
                                p<span class="operator">.</span>stringParity<span class="operator">,</span> p<span class="operator">.</span>stringStopBits<span class="operator">,</span> p<span class="operator">.</span>stringFlowControl));
     } <span class="keyword">else</span> {
         <span class="type">QMessageBox</span><span class="operator">::</span>critical(<span class="keyword">this</span><span class="operator">,</span> tr(<span class="string">&quot;Error&quot;</span>)<span class="operator">,</span> m_serial<span class="operator">-</span><span class="operator">&gt;</span>errorString());

         showStatusMessage(tr(<span class="string">&quot;Open error&quot;</span>));
     }
 }
</pre>
<p>In this slot, the settings are read from <code translate="no">SettingsDialog</code> and an attempt is made to open and initialize the serial port accordingly. If successful, the status bar displays a message that the opening was successful with the given configuration; otherwise, a messagebox is displayed with the appropriate error code and message. If the serial port settings have never been called then the terminal attempts to open the port with the default settings: 9600 8N1.</p>
<p>Clicking on the <b>Disconnect</b> button invokes the <code translate="no">closeSerialPort()</code> slot:</p>
<pre class="cpp" translate="no">
 <span class="type">void</span> MainWindow<span class="operator">::</span>closeSerialPort()
 {
     <span class="keyword">if</span> (m_serial<span class="operator">-</span><span class="operator">&gt;</span>isOpen())
         m_serial<span class="operator">-</span><span class="operator">&gt;</span>close();
     m_console<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">false</span>);
     m_ui<span class="operator">-</span><span class="operator">&gt;</span>actionConnect<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">true</span>);
     m_ui<span class="operator">-</span><span class="operator">&gt;</span>actionDisconnect<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">false</span>);
     m_ui<span class="operator">-</span><span class="operator">&gt;</span>actionConfigure<span class="operator">-</span><span class="operator">&gt;</span>setEnabled(<span class="keyword">true</span>);
     showStatusMessage(tr(<span class="string">&quot;Disconnected&quot;</span>));
 }
</pre>
<p>In this case, handled by the closure of the serial port.</p>
<p>Clicking on the <b>Configure</b> button invokes the <code translate="no">show()</code> slot which belongs to the <code translate="no">SettingsDialog</code> widget.</p>
<p>This method (<code translate="no">terminal/settingsdialog.cpp</code>) displays the <code translate="no">SettingsDialog</code>, in which the user can choose the desired serial port, see the information about the selected port, and set the desired parameters of the given serial port.</p>
<h5 id="writing-data">Writing Data</h5>
<p>Typing characters in the console invokes the <code translate="no">writeData()</code> slot:</p>
<pre class="cpp" translate="no">
 <span class="type">void</span> MainWindow<span class="operator">::</span>writeData(<span class="keyword">const</span> <span class="type"><a href="../qtcore/qbytearray.html" translate="no">QByteArray</a></span> <span class="operator">&amp;</span>data)
 {
     <span class="keyword">const</span> <span class="type"><a href="../qtcore/qttypes.html#qint64-typedef" translate="no">qint64</a></span> written <span class="operator">=</span> m_serial<span class="operator">-</span><span class="operator">&gt;</span>write(data);
     <span class="keyword">if</span> (written <span class="operator">=</span><span class="operator">=</span> data<span class="operator">.</span>size()) {
         m_bytesToWrite <span class="operator">+</span><span class="operator">=</span> written;
         m_timer<span class="operator">-</span><span class="operator">&gt;</span>start(kWriteTimeout);
     } <span class="keyword">else</span> {
         <span class="keyword">const</span> <span class="type"><a href="../qtcore/qstring.html" translate="no">QString</a></span> error <span class="operator">=</span> tr(<span class="string">&quot;Failed to write all data to port %1.\n&quot;</span>
                                  <span class="string">&quot;Error: %2&quot;</span>)<span class="operator">.</span>arg(m_serial<span class="operator">-</span><span class="operator">&gt;</span>portName()<span class="operator">,</span>
                                                   m_serial<span class="operator">-</span><span class="operator">&gt;</span>errorString());
         showWriteError(error);
     }
 }
</pre>
<p>This slot sends the characters typed in the given Console widget to the serial port - see <code translate="no">terminal/console.cpp</code>. It also starts a timer to track if the write actually succeeded or not. We use the <a href="../qtcore/qiodevice.html#bytesWritten" translate="no">bytesWritten</a>() signal to make sure that all bytes are actually written. It is connected to the <code translate="no">MainWindow::handleBytesWritten()</code> slot:</p>
<pre class="cpp" translate="no">
 <span class="type">void</span> MainWindow<span class="operator">::</span>handleBytesWritten(<span class="type"><a href="../qtcore/qttypes.html#qint64-typedef" translate="no">qint64</a></span> bytes)
 {
     m_bytesToWrite <span class="operator">-</span><span class="operator">=</span> bytes;
     <span class="keyword">if</span> (m_bytesToWrite <span class="operator">=</span><span class="operator">=</span> <span class="number">0</span>)
         m_timer<span class="operator">-</span><span class="operator">&gt;</span>stop();
 }
</pre>
<h5 id="reading-data">Reading Data</h5>
<p>When the serial port receives new data, the signal <a href="../qtcore/qiodevice.html#readyRead" translate="no">readyRead</a>() is emitted, and that signal is connected to the <code translate="no">MainWindow::readData()</code> slot:</p>
<pre class="cpp" translate="no">
 <span class="type">void</span> MainWindow<span class="operator">::</span>readData()
 {
     <span class="keyword">const</span> <span class="type"><a href="../qtcore/qbytearray.html" translate="no">QByteArray</a></span> data <span class="operator">=</span> m_serial<span class="operator">-</span><span class="operator">&gt;</span>readAll();
     m_console<span class="operator">-</span><span class="operator">&gt;</span>putData(data);
 }
</pre>
<p>This slot reads the data from the serial port and displays that in the Console widget.</p>
<h4 id="running-the-example">Running the Example</h4>
<p>To run the example from <a href="https://doc.qt.io/qtcreator/index.html" translate="no">Qt Creator</a>, open the <b translate="no">Welcome</b> mode and select the example from <b translate="no">Examples</b>. For more information, visit <a href="https://doc.qt.io/qtcreator/creator-build-example-application.html" translate="no">Building and Running an Example</a>.</p>
<p><a href="https://code.qt.io/cgit/qt/qtserialport.git/tree/examples/serialport/terminal?h=6.6" translate="no">Example project @ code.qt.io</a></p>
</div>
<p><b>See also </b><a href="qtserialport-blockingreceiver-example.html" translate="no">Blocking Receiver</a>.</p>
<!-- @@@terminal -->
        </div>
       </div>
   </div>
   </div>
</div>
<div class="footer">
   <p>
   <acronym title="Copyright">&copy;</acronym> 2024 <span translate="no">The Qt Company Ltd.</span>
   Documentation contributions included herein are the copyrights of
   their respective owners.<br/>    The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the <span translate="no">Free Software Foundation</span>.<br/>    <span translate="no">Qt</span> and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of <span translate="no">The Qt Company Ltd.</span> in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>
</div>
</body>
</html>
