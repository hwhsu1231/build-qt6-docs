<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<!-- qtcoap-overview.qdoc -->
  <meta name="description" content="Provides insight into the CoAP protocol and the Qt CoAP module.">
  <title>Qt CoAP Overview | Qt CoAP 6.6.0</title>
  <link rel="stylesheet" type="text/css" href="style/offline-simple.css" />
  <script type="text/javascript">
    document.getElementsByTagName("link").item(0).setAttribute("href", "style/offline.css");
    // loading style sheet breaks anchors that were jumped to before
    // so force jumping to anchor again
    setTimeout(function() {
        var anchor = location.hash;
        // need to jump to different anchor first (e.g. none)
        location.hash = "#";
        setTimeout(function() {
            location.hash = anchor;
        }, 0);
    }, 0);
  </script>
</head>
<body>
<div class="header" id="qtdocheader">
    <div class="main">
    <div class="main-rounded">
        <div class="navigationbar">
        <ul>
<li><a href="../qtdoc/index.html" translate="no">Qt 6.6</a></li>
<li><a href="qtcoap-index.html" translate="no">Qt CoAP</a></li>
<li>Qt CoAP Overview</li>
<li id="buildversion"><a href="qtcoap-index.html" translate="no">Qt 6.6&#x2e;0 Reference Documentation</a></li>
    </ul>
    </div>
</div>
<div class="content">
<div class="line">
<div class="content mainContent">
<div class="sidebar">
<div class="toc">
<h3 id="toc">Contents</h3>
<ul>
<li class="level1"><a href="#messaging-model">Messaging Model</a></li>
<li class="level1"><a href="#using-the-qt-coap-api">Using the Qt CoAP API</a></li>
<li class="level1"><a href="#supported-features">Supported Features</a></li>
<li class="level2"><a href="#resource-discovery">Resource Discovery</a></li>
<li class="level2"><a href="#resource-observation">Resource Observation</a></li>
<li class="level2"><a href="#blockwise-transfers">Blockwise Transfers</a></li>
<li class="level2"><a href="#security">Security</a></li>
</ul>
</div>
<div class="sidebar-content" id="sidebar-content"></div></div>
<h1 class="title">Qt CoAP Overview</h1>
<!-- $$$qtcoap-overview.html-description -->
<div class="descr" id="details">
<p>Constrained Application Protocol (CoAP) is an IoT protocol that is specifically designed for M2M data exchange between constrained devices (such as microcontrollers) in constrained networks.</p>
<p>The interaction model of CoAP is similar to the client/server model of HTTP, but unlike HTTP, it uses datagram-oriented connectionless transport such as UDP, which leads to a very low overhead and allows UDP broadcast and multicast to be used for addressing. At the same time it provides lightweight reliability mechanisms and security.</p>
<p>Qt CoAP implements the client side of CoAP. By default, the transport layer uses <a href="../qtnetwork/qudpsocket.html" translate="no">QUdpSocket</a> and <a href="../qtnetwork/qdtls.html" translate="no">QDtls</a> for security. Alternative transports can be used by implementing the QCoapConnection interface.</p>
<h2 id="messaging-model">Messaging Model</h2>
<p>The CoAP messaging model is based on the exchange of messages between endpoints: clients make requests to servers; servers send back responses. Clients may <i>GET</i>, <i>PUT</i>, <i>POST</i> and <i>DELETE</i> resources. They can also discover resources on a server by making discovery requests, or in the local network, by making multicast discovery requests. It is also possible to subscribe to a resource, with an observe request.</p>
<p>Reliability of the transfer is achieved by marking a message <i>confirmable</i> (CON). A confirmable message is retransmitted using a default timeout and exponential back-off between retransmissions, until the recipient sends an <i>acknowledgment</i> (ACK) message. When the recipient is not able to process a confirmable message, it replies with a <i>reset</i> message (RST) instead of an acknowledgment.</p>
<p>A message that does not require reliable transmission can be sent as a <i>non-confirmable</i> (NON) message.</p>
<h2 id="using-the-qt-coap-api">Using the Qt CoAP API</h2>
<p>The communication of the client with the CoAP server is done using the <a href="qcoapclient.html" translate="no">QCoapClient</a> class. It contains the methods for sending different CoAP requests and the signals that get triggered when the replies for the sent request arrive. The <a href="qcoaprequest.html" translate="no">QCoapRequest</a> class is used for creating CoAP requests. The response from the server is returned in a <a href="qcoapreply.html" translate="no">QCoapReply</a> object. For example:</p>
<pre class="cpp" translate="no">
 <span class="type"><a href="qcoapclient.html" translate="no">QCoapClient</a></span> <span class="operator">*</span>client <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qcoapclient.html" translate="no">QCoapClient</a></span>();
 connect(client<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="qcoapclient.html" translate="no">QCoapClient</a></span><span class="operator">::</span>finished<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>MyClass<span class="operator">::</span>onFinished);
 connect(client<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="qcoapclient.html" translate="no">QCoapClient</a></span><span class="operator">::</span>error<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>MyClass<span class="operator">::</span>onError);

 <span class="type"><a href="qcoaprequest.html" translate="no">QCoapRequest</a></span> request(<span class="type"><a href="../qtcore/qurl.html" translate="no">QUrl</a></span>(<span class="string">&quot;coap://127.0.0.1/test&quot;</span>)<span class="operator">,</span> <span class="type"><a href="qcoapmessage.html" translate="no">QCoapMessage</a></span><span class="operator">::</span>Confirmable);
 client<span class="operator">-</span><span class="operator">&gt;</span>get(request);
 client<span class="operator">-</span><span class="operator">&gt;</span>put(request<span class="operator">,</span> <span class="type"><a href="../qtcore/qbytearray.html" translate="no">QByteArray</a></span>(<span class="string">&quot;payload&quot;</span>));
</pre>
<h2 id="supported-features">Supported Features</h2>
<h3 id="resource-discovery">Resource Discovery</h3>
<p>CoAP discovery requests are used to query the resources available on an endpoint or in the complete network. This is really important for M2M applications, where there are no humans in the loop. For example, for home or building automation, there is a need for local clients and servers to find and interact with each other without human intervention. Resource discovery allows clients to learn about the endpoints available in the network.</p>
<p>Qt CoAP supports discovery requests to a single endpoint and to multicast groups. For example, a discovery request to <code translate="no">/.well-known/core</code>, which is the default resource discovery entry point, may return something like:</p>
<pre class="cpp plain" translate="no">
 RES: 2.05 Content
 &lt;/sensors/temp&gt;;rt=&quot;temperature-c&quot;;if=&quot;sensor&quot;;obs,
 &lt;/sensors/light&gt;;rt=&quot;light-lux&quot;;if=&quot;sensor&quot;,
 &lt;/firmware/v2.1&gt;;rt=&quot;firmware&quot;;sz=262144
</pre>
<p>Indicating that there are resources for temperature and light sensors and a firmware resource available in the network. The reply is represented in <a href="https://tools.ietf.org/html/rfc6690" translate="no">CoRE Link Format</a>.</p>
<p>The specialized <a href="qcoapresourcediscoveryreply.html" translate="no">QCoapResourceDiscoveryReply</a> class is used to get the discovery replies:</p>
<pre class="cpp" translate="no">
 <span class="comment">// This will make a multicast discovery request to the CoAP IPv4 multicast group.</span>
 <span class="type"><a href="qcoapresourcediscoveryreply.html" translate="no">QCoapResourceDiscoveryReply</a></span> <span class="operator">*</span>discoverReply <span class="operator">=</span> client<span class="operator">-</span><span class="operator">&gt;</span>discover();
 connect(discoverReply<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="qcoapresourcediscoveryreply.html" translate="no">QCoapResourceDiscoveryReply</a></span><span class="operator">::</span>discovered<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>MyClass<span class="operator">::</span>onDiscovered);
</pre>
<p>The <a href="qcoapresourcediscoveryreply.html#discovered" translate="no">QCoapResourceDiscoveryReply::discovered</a> will return the list of CoAP resources found in the network.</p>
<h3 id="resource-observation">Resource Observation</h3>
<p>Observe requests are used to receive automatic server notifications for a resource. The client becomes an observer of an observable resource by sending an observe request to the resource. For example, the temperature sensor from the above example is observable, because it has the <code translate="no">obs</code> attribute. So the client can subscribe to the temperature updates by sending an observe request to it.</p>
<p>The following example code shows how to send observe requests using Qt CoAP:</p>
<pre class="cpp" translate="no">
 <span class="type"><a href="qcoapreply.html" translate="no">QCoapReply</a></span> <span class="operator">*</span>reply <span class="operator">=</span> client<span class="operator">-</span><span class="operator">&gt;</span>observe(<span class="type"><a href="../qtcore/qurl.html" translate="no">QUrl</a></span>(<span class="string">&quot;127.0.0.1/temp&quot;</span>));
 connect(reply<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="qcoapreply.html" translate="no">QCoapReply</a></span><span class="operator">::</span>notified<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span>MyClass<span class="operator">::</span>onNotified);
</pre>
<p>For Observe requests specifically, you can use the <a href="qcoapreply.html#notified" translate="no">QCoapReply::notified</a> signal to handle notifications from the CoAP server.</p>
<h3 id="blockwise-transfers">Blockwise Transfers</h3>
<p>Since CoAP is based on datagram transports such as UDP, there are limits on how big a resource representation can be, to be transferred without fragmentation causing problems. Qt CoAP supports block-wise transfers for situations where a resource representation is larger than can be comfortably transferred in the payload of a single CoAP datagram.</p>
<h3 id="security">Security</h3>
<p>The following security modes are defined for CoAP:</p>
<ul>
<li><b>Pre-Shared Key</b> - in this mode the client must send to the server its identity and the pre-shared key.</li>
<li><b>Raw Public Key</b> - the client has an asymmetric key pair without a certificate (a raw public key). The client also has an identity calculated from the public key and a list of identities of the nodes it can communicate with. Qt CoAP has not implemented this mode yet.</li>
<li><b>Certificate</b> - the client has an asymmetric key pair with an X.509 certificate that is signed by some common trust root.</li>
</ul>
<p>Since CoAP is designed to be a UDP-based protocol, Qt CoAP module implements security based on Datagram TLS (DTLS) over UDP. However, as mentioned above, it is possible to provide a custom transport with another security type.</p>
<p>For securing the CoAP client, one of the supported security modes should be specified when creating the client:</p>
<pre class="cpp" translate="no">
 <span class="type"><a href="qcoapclient.html" translate="no">QCoapClient</a></span> <span class="operator">*</span>client <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qcoapclient.html" translate="no">QCoapClient</a></span>(<span class="keyword">this</span><span class="operator">,</span> <span class="type"><a href="qtcoap-module.html" translate="no">QtCoap</a></span><span class="operator">::</span>PreSharedKey);
</pre>
<p>The <a href="qcoapsecurityconfiguration.html" translate="no">QCoapSecurityConfiguration</a> class is used for specifying the security parameters. For example, in pre-shared key mode the following example code can be used:</p>
<pre class="cpp" translate="no">
 <span class="type"><a href="qcoapsecurityconfiguration.html" translate="no">QCoapSecurityConfiguration</a></span> config;
 config<span class="operator">.</span>setPreSharedKey(<span class="string">&quot;secretPSK&quot;</span>);
 config<span class="operator">.</span>setIdentity(<span class="string">&quot;Client_identity&quot;</span>);
 client<span class="operator">-</span><span class="operator">&gt;</span>setSecurityConfiguration(config);
</pre>
<p>And in certificate mode:</p>
<pre class="cpp" translate="no">
 <span class="type"><a href="qcoapclient.html" translate="no">QCoapClient</a></span> <span class="operator">*</span>client <span class="operator">=</span> <span class="keyword">new</span> <span class="type"><a href="qcoapclient.html" translate="no">QCoapClient</a></span>(<span class="keyword">this</span><span class="operator">,</span> <span class="type"><a href="qtcoap-module.html" translate="no">QtCoap</a></span><span class="operator">::</span>Certificate);
 <span class="type"><a href="../qtcore/qlist.html" translate="no">QList</a></span><span class="operator">&lt;</span><span class="type"><a href="../qtnetwork/qsslcertificate.html" translate="no">QSslCertificate</a></span><span class="operator">&gt;</span> localCertificates<span class="operator">,</span> caCertificates;
 <span class="type"><a href="qcoapprivatekey.html" translate="no">QCoapPrivateKey</a></span> key;
 <span class="comment">// Initialize the key and certificates</span>
 <span class="type"><a href="qcoapsecurityconfiguration.html" translate="no">QCoapSecurityConfiguration</a></span> config;
 config<span class="operator">.</span>setLocalCertificateChain(localCertificates);
 config<span class="operator">.</span>setCaCertificates(caCertificates)
 config<span class="operator">.</span>setPrivateKey(key);
 client<span class="operator">-</span><span class="operator">&gt;</span>setSecurityConfiguration(config);
</pre>
</div>
<!-- @@@qtcoap-overview.html -->
        </div>
       </div>
   </div>
   </div>
</div>
<div class="footer">
   <p>
   <acronym title="Copyright">&copy;</acronym> 2023 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.<br/>    The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.<br/>    Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>
</div>
</body>
</html>
