<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<!-- styleplugin.qdoc -->
  <meta name="description" content="This example shows how to create a plugin that extends Qt with a new GUI look and feel.">
  <title>Style Plugin Example | Qt Widgets 6.6.0</title>
  <link rel="stylesheet" type="text/css" href="style/offline-simple.css" />
  <script type="text/javascript">
    document.getElementsByTagName("link").item(0).setAttribute("href", "style/offline.css");
    // loading style sheet breaks anchors that were jumped to before
    // so force jumping to anchor again
    setTimeout(function() {
        var anchor = location.hash;
        // need to jump to different anchor first (e.g. none)
        location.hash = "#";
        setTimeout(function() {
            location.hash = anchor;
        }, 0);
    }, 0);
  </script>
</head>
<body>
<div class="header" id="qtdocheader">
    <div class="main">
    <div class="main-rounded">
        <div class="navigationbar">
        <ul>
<li><a href="../qtdoc/index.html" translate="no">Qt 6.6</a></li>
<li><a href="qtwidgets-index.html" translate="no">Qt Widgets</a></li>
<li>Style Plugin Example</li>
<li id="buildversion"><a href="qtwidgets-index.html" translate="no">Qt 6.6&#x2e;0 Reference Documentation</a></li>
    </ul>
    </div>
</div>
<div class="content">
<div class="line">
<div class="content mainContent">
<div class="sidebar">
<div class="toc">
<h3 id="toc">Contents</h3>
<ul>
<li class="level1"><a href="#simplestyleplugin-class-definition">SimpleStylePlugin Class Definition</a></li>
<li class="level1"><a href="#simplestyleplugin-class-implementation">SimpleStylePlugin Class Implementation</a></li>
<li class="level1"><a href="#the-main-function">The <code translate="no">main()</code> function</a></li>
<li class="level1"><a href="#the-simple-style-plugin-s-qmake-project-file">The Simple Style Plugin's QMake Project File</a></li>
<li class="level2"><a href="#using-cmake-to-set-up-the-simple-style-plugin">Using CMake to Set up the Simple Style Plugin</a></li>
<li class="level1"><a href="#related-articles-and-examples">Related Articles and Examples</a></li>
</ul>
</div>
<div class="sidebar-content" id="sidebar-content"></div></div>
<h1 class="title">Style Plugin Example</h1>
<!-- $$$tools/styleplugin-brief -->
<p>This example shows how to create a plugin that extends Qt with a new GUI look and feel.</p>
<!-- @@@tools/styleplugin -->
<!-- $$$tools/styleplugin-description -->
<div class="descr" id="details">
<p class="centerAlign"><img src="images/stylepluginexample.png" alt="" /></p><p>A plugin in Qt is a class stored in a shared library that can be loaded by a <a href="../qtcore/qpluginloader.html" translate="no">QPluginLoader</a> at run-time. When you create plugins in Qt, they either extend a Qt application or Qt itself. Writing a plugin that extends Qt itself is achieved by inheriting one of the plugin <a href="../qtcore/plugins.html" translate="no">base classes</a>, reimplementing functions from that class, and adding a macro. In this example we extend Qt by adding a new GUI look and feel (i.e&#x2e;, making a new <a href="qstyle.html" translate="no">QStyle</a> available). A high-level introduction to plugins is given in the plugin <a href="../qtdoc/plugins-howto.html" translate="no">overview document</a>.</p>
<p>Plugins that provide new styles inherit the <a href="qstyleplugin.html" translate="no">QStylePlugin</a> base class. Style plugins are loaded by Qt and made available through <a href="qstylefactory.html" translate="no">QStyleFactory</a>; we will look at this later. We have implemented <code translate="no">SimpleStylePlugin</code>, which provides <code translate="no">SimpleStyle</code>. The new style contributes to widget styling by changing the text color of the text edit widget to red - not a major contribution, but it still makes a new style.</p>
<p>The new style is platform agnostic in the sense that it is not based on any specific style implementation, but uses <a href="qproxystyle.html" translate="no">QProxyStyle</a> to merely tweak the looks in the current application style that defaults to the native system style.</p>
<div class="admonition note">
<p><b>Note: </b>On some platforms, the native style may overwrite some custom stylings, e.g&#x2e;, button background color. In that case, try to run your application in another style (e.g&#x2e;, fusion). You may do this by passing <code translate="no">-style fusion</code> as a command line argument to your application.</p>
</div>
<p>We test the plugin with <code translate="no">StyleWindow</code>, in which we display a <a href="qtextedit.html" translate="no">QTextEdit</a>. The <code translate="no">SimpleStyle</code> and <code translate="no">StyleWindow</code> classes do not contain any plugin specific functionality and their implementations are trivial; we will therefore leap past them and head on to the <code translate="no">SimpleStylePlugin</code> and the <code translate="no">main()</code> function. After we have looked at that, we examine the plugin's <code translate="no">.pro</code> file.</p>
<h4 id="simplestyleplugin-class-definition">SimpleStylePlugin Class Definition</h4>
<p><code translate="no">SimpleStylePlugin</code> inherits <a href="qstyleplugin.html" translate="no">QStylePlugin</a> and is the plugin class.</p>
<pre class="cpp" translate="no">
 <span class="keyword">class</span> SimpleStylePlugin : <span class="keyword">public</span> <span class="type"><a href="qstyleplugin.html" translate="no">QStylePlugin</a></span>
 {
     Q_OBJECT
     Q_PLUGIN_METADATA(IID <span class="string">&quot;org.qt-project.Qt.QStyleFactoryInterface&quot;</span> FILE <span class="string">&quot;simplestyle.json&quot;</span>)

 <span class="keyword">public</span>:
     SimpleStylePlugin() <span class="operator">=</span> <span class="keyword">default</span>;

     <span class="type"><a href="../qtcore/qstringlist.html" translate="no">QStringList</a></span> keys() <span class="keyword">const</span>;
     <span class="type"><a href="qstyle.html" translate="no">QStyle</a></span> <span class="operator">*</span>create(<span class="keyword">const</span> <span class="type"><a href="../qtcore/qstring.html" translate="no">QString</a></span> <span class="operator">&amp;</span>key) override;
 };
</pre>
<p><code translate="no">keys()</code> returns a list of style names that this plugin can create, while <code translate="no">create()</code> takes such a string and returns the <a href="qstyle.html" translate="no">QStyle</a> corresponding to the key. Both functions are pure virtual functions reimplemented from <a href="qstyleplugin.html" translate="no">QStylePlugin</a>. When an application requests an instance of the <code translate="no">SimpleStyle</code> style, which this plugin creates, Qt will create it with this plugin.</p>
<h4 id="simplestyleplugin-class-implementation">SimpleStylePlugin Class Implementation</h4>
<p>Here is the implementation of <code translate="no">keys()</code>:</p>
<pre class="cpp" translate="no">
 <span class="type"><a href="../qtcore/qstringlist.html" translate="no">QStringList</a></span> SimpleStylePlugin<span class="operator">::</span>keys() <span class="keyword">const</span>
 {
     <span class="keyword">return</span> {<span class="string">&quot;SimpleStyle&quot;</span>};
 }
</pre>
<p>Since this plugin only supports one style, we return a <a href="../qtcore/qstringlist.html" translate="no">QStringList</a> with the class name of that style.</p>
<p>Here is the <code translate="no">create()</code> function:</p>
<pre class="cpp" translate="no">
 <span class="type"><a href="qstyle.html" translate="no">QStyle</a></span> <span class="operator">*</span>SimpleStylePlugin<span class="operator">::</span>create(<span class="keyword">const</span> <span class="type"><a href="../qtcore/qstring.html" translate="no">QString</a></span> <span class="operator">&amp;</span>key)
 {
     <span class="keyword">if</span> (key<span class="operator">.</span>toLower() <span class="operator">=</span><span class="operator">=</span> <span class="string">&quot;simplestyle&quot;</span>)
         <span class="keyword">return</span> <span class="keyword">new</span> SimpleStyle;
     <span class="keyword">return</span> nullptr;
 }
</pre>
<p>Note that the key for style plugins are case insensitive. The case sensitivity varies from plugin to plugin, so you need to check this when implementing new plugins.</p>
<h4 id="the-main-function">The <code translate="no">main()</code> function</h4>
<pre class="cpp" translate="no">
 <span class="type">int</span> main(<span class="type">int</span> argv<span class="operator">,</span> <span class="type">char</span> <span class="operator">*</span>args<span class="operator">[</span><span class="operator">]</span>)
 {
     <span class="type"><a href="qapplication.html" translate="no">QApplication</a></span> app(argv<span class="operator">,</span> args);

     <span class="type"><a href="qstyle.html" translate="no">QStyle</a></span> <span class="operator">*</span>style <span class="operator">=</span> <span class="type"><a href="qstylefactory.html" translate="no">QStyleFactory</a></span><span class="operator">::</span>create(<span class="string">&quot;simplestyle&quot;</span>);
     <span class="keyword">if</span> (<span class="operator">!</span>style)
         <a href="../qtcore/qtlogging.html#qFatal" translate="no">qFatal</a>(<span class="string">&quot;Cannot load the 'simplestyle' plugin.&quot;</span>);

     <span class="type"><a href="qapplication.html" translate="no">QApplication</a></span><span class="operator">::</span>setStyle(style);

     StyleWindow window;
     window<span class="operator">.</span>resize(<span class="number">350</span><span class="operator">,</span> <span class="number">50</span>);
     window<span class="operator">.</span>show();

     <span class="keyword">return</span> app<span class="operator">.</span>exec();
 }
</pre>
<p>Qt loads the available style plugins when the <a href="qapplication.html" translate="no">QApplication</a> object is initialized. The <a href="qstylefactory.html" translate="no">QStyleFactory</a> class knows about all styles and produces them with <a href="qstylefactory.html#create" translate="no">create</a>() (it is a wrapper around all the style plugins).</p>
<h4 id="the-simple-style-plugin-s-qmake-project-file">The Simple Style Plugin's QMake Project File</h4>
<p>The <code translate="no">SimpleStylePlugin</code> lives in its own directory and has its own <code translate="no">.pro</code> file:</p>
<pre class="cpp" translate="no">
 TEMPLATE    = lib
 CONFIG     += plugin
 QT         += widgets
 HEADERS     = simplestyle.h \
               simplestyleplugin.h
 SOURCES     = simplestyle.cpp \
               simplestyleplugin.cpp
 TARGET      = simplestyleplugin
</pre>
<p>In the plugin <code translate="no">.pro</code> file we need to set the lib template as we are building a shared library instead of an executable. We must also set the config to plugin. We set the library to be stored in the <code translate="no">styles</code> folder next to the main executable because this is a path in which Qt will search for style plugins.</p>
<h5 id="using-cmake-to-set-up-the-simple-style-plugin">Using CMake to Set up the Simple Style Plugin</h5>
<p>When using CMake, we use <a href="../qtcore/qt-add-plugin.html" translate="no">qt_add_plugin</a> to create the <code translate="no">simplestyleplugin</code> plugin:</p>
<pre class="cpp" translate="no">
 qt_add_plugin(simplestyleplugin
     CLASS_NAME SimpleStylePlugin
     simplestyle.cpp simplestyle.h
     simplestyleplugin.cpp simplestyleplugin.h
 )
</pre>
<p>On Windows and Linux, we place the plugin into the <code translate="no">styles</code> folder next to the main executable, i.e&#x2e;, <code translate="no">styleplugin.exe</code>:</p>
<pre class="cpp" translate="no">
     set_target_properties(simplestyleplugin PROPERTIES
         LIBRARY_OUTPUT_DIRECTORY &quot;$&lt;TARGET_FILE_DIR:styleplugin&gt;/styles&quot;
     )
</pre>
<p>And on macOS, we store the <code translate="no">simplestyleplugin</code> into the <code translate="no">Contents/PlugIns/styles</code> folder of the App Bundle.</p>
<pre class="cpp" translate="no">
     set_target_properties(simplestyleplugin PROPERTIES
         LIBRARY_OUTPUT_DIRECTORY &quot;$&lt;TARGET_BUNDLE_CONTENT_DIR:styleplugin&gt;/PlugIns/styles&quot;
     )
</pre>
<div class="admonition note">
<p><b>Note: </b>On macOS, when creating an App Bundle, store the plugins in the <code translate="no">PlugIns</code> folder and not next to the main executable in the <code translate="no">MacOS</code> folder as the latter will cause issues during signing and distribution of the app.</p>
</div>
<h4 id="related-articles-and-examples">Related Articles and Examples</h4>
<p>In addition to the plugin <a href="../qtdoc/plugins-howto.html" translate="no">overview document</a>, we have other examples and articles that concern plugins.</p>
<p>In the <a href="qtwidgets-tools-echoplugin-example.html" translate="no">echo plugin example</a> we show how to implement plugins that extends Qt applications rather than Qt itself, which is the case with the style plugin of this example.</p>
<p><a href="https://code.qt.io/cgit/qt/qtbase.git/tree/examples/widgets/tools/styleplugin?h=6.6" translate="no">Example project @ code.qt.io</a></p>
</div>
<!-- @@@tools/styleplugin -->
        </div>
       </div>
   </div>
   </div>
</div>
<div class="footer">
   <p>
   <acronym title="Copyright">&copy;</acronym> 2023 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.<br/>    The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.<br/>    Qt and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of The Qt Company Ltd. in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>
</div>
</body>
</html>
