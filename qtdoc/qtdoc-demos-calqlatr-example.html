<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<!-- calqlatr.qdoc -->
  <meta name="description" content="A Qt Quick app designed for portrait devices that uses custom components, animated with AnimationController, and JavaScript for the application logic.">
  <title>Calqlatr | Qt 6.6</title>
  <link rel="stylesheet" type="text/css" href="style/offline-simple.css" />
  <script type="text/javascript">
    document.getElementsByTagName("link").item(0).setAttribute("href", "style/offline.css");
    // loading style sheet breaks anchors that were jumped to before
    // so force jumping to anchor again
    setTimeout(function() {
        var anchor = location.hash;
        // need to jump to different anchor first (e.g. none)
        location.hash = "#";
        setTimeout(function() {
            location.hash = anchor;
        }, 0);
    }, 0);
  </script>
</head>
<body>
<div class="header" id="qtdocheader">
    <div class="main">
    <div class="main-rounded">
        <div class="navigationbar">
        <ul>
<li><a href="index.html" translate="no">Qt 6.6</a></li>
<li>Calqlatr</li>
<li id="buildversion">Qt 6.6.2 Reference Documentation</li>
    </ul>
    </div>
</div>
<div class="content">
<div class="line">
<div class="content mainContent">
<div class="sidebar">
<div class="toc">
<h3 id="toc">Contents</h3>
<ul>
<li class="level1"><a href="#running-the-example">Running the Example</a></li>
<li class="level1"><a href="#displaying-custom-components">Displaying Custom Components</a></li>
<li class="level1"><a href="#animating-components">Animating Components</a></li>
<li class="level1"><a href="#performing-calculations">Performing Calculations</a></li>
<li class="level1"><a href="#list-of-files">List of Files</a></li>
</ul>
</div>
<div class="sidebar-content" id="sidebar-content"></div></div>
<h1 class="title">Calqlatr</h1>
<!-- $$$demos/calqlatr-brief -->
<p>A Qt Quick app designed for portrait devices that uses custom components, animated with <a href="../qt3d/qml-qt3d-animation-animationcontroller.html" translate="no">AnimationController</a>, and JavaScript for the application logic.</p>
<!-- @@@demos/calqlatr -->
<!-- $$$demos/calqlatr-description -->
<div class="descr" id="details">
<p class="centerAlign"><img src="images/qtquick-demo-calqlatr.png" alt="" /></p><p><i>Calqlatr</i> demonstrates various QML and <a href="../qtquick/qtquick-index.html" translate="no">Qt Quick</a> features, such as displaying custom components and using animation to move the components around in the application view. The application logic is implemented in JavaScript and the appearance is implemented in QML.</p>
<h4 id="running-the-example">Running the Example</h4>
<p>To run the example from <a href="https://doc.qt.io/qtcreator/index.html" translate="no">Qt Creator</a>, open the <b translate="no">Welcome</b> mode and select the example from <b translate="no">Examples</b>. For more information, visit <a href="https://doc.qt.io/qtcreator/creator-build-example-application.html" translate="no">Building and Running an Example</a>.</p>
<h4 id="displaying-custom-components">Displaying Custom Components</h4>
<p>In the Calqlatr application, we use the following custom types that are each defined in a separate .qml file:</p>
<ul>
<li>CalculatorButton.qml</li>
<li>Display.qml</li>
<li>NumberPad.qml</li>
</ul>
<p>To use the custom types, we add an import statement to the main QML file, calqlatr.qml that imports the folder called <code translate="no">content</code> where the types are located:</p>
<pre class="cpp" translate="no">
 import <span class="string">&quot;content&quot;</span>
</pre>
<p>We can then display custom components by adding the component types to any QML file. For example, we use the NumberPad type in calqlatr.qml to create the number pad of the calculator. We place the type inside an <a href="../qtquick/qml-qtquick-item.html" translate="no">Item</a> QML type, which is the base type for all visual items in Qt Quick:</p>
<pre class="cpp" translate="no">
     <span class="type"><a href="../qtquick/qml-qtquick-item.html" translate="no">Item</a></span> {
         <span class="name">id</span>: <span class="name">pad</span>
         <span class="name">width</span>: <span class="number">180</span>
         <span class="type">NumberPad</span> {
             <span class="name">id</span>: <span class="name">numPad</span>
             <span class="name">y</span>: <span class="number">10</span>
             <span class="name">anchors</span>.horizontalCenter: <span class="name">pad</span>.<span class="name">horizontalCenter</span>
             <span class="name">display</span>: <span class="name">display</span>
         }
     }
</pre>
<p>Further, we use the CalculatorButton type in the <code translate="no">NumberPad</code> type to create the calculator buttons. <code translate="no">CalculatorButton.qml</code> specifies the basic properties for a button that we can modify for each button instance in <code translate="no">NumberPad.qml</code>. For the digit and separator buttons, we additionally specify the <code translate="no">text</code> property.</p>
<p>For the operator buttons, we also specify another color (green) using the property alias <code translate="no">color</code> and set the operator property to <code translate="no">true</code>. We use the operator property in functions that perform the calculations.</p>
<p>We place the buttons inside a <a href="../qtquick/qml-qtquick-grid.html" translate="no">Grid</a> QML type to position them in a grid:</p>
<pre class="cpp" translate="no">
 <span class="type"><a href="../qtquick/qml-qtquick-grid.html" translate="no">Grid</a></span> {
     <span class="name">id</span>: <span class="name">root</span>
     <span class="name">columns</span>: <span class="number">3</span>
     <span class="name">columnSpacing</span>: <span class="number">2</span>
     <span class="name">rowSpacing</span>: <span class="number">2</span>

     required property <span class="type">Display</span> <span class="name">display</span>

     <span class="keyword">function </span><span class="name">updateDimmed</span>() {
         <span class="keyword">for</span> (let i = 0; <span class="name">i</span> <span class="operator">&lt;</span> <span class="name">children</span>.<span class="name">length</span>; i++) {
             <span class="name">children</span>[<span class="name">i</span>].<span class="name">dimmed</span> <span class="operator">=</span> <span class="name">CalcEngine</span>.<span class="name">isOperationDisabled</span>(<span class="name">children</span>[<span class="name">i</span>].<span class="name">text</span>)
         }
     }

     component DigitButton: <span class="type">CalculatorButton</span> {
         <span class="name">onPressed</span>: <span class="keyword">function</span>() {
             <span class="name">CalcEngine</span>.<span class="name">digitPressed</span>(<span class="name">text</span>, <span class="name">root</span>.<span class="name">display</span>)
             <span class="name">root</span>.<span class="name">updateDimmed</span>()
         }
     }

     component OperatorButton: <span class="type">CalculatorButton</span> {
         <span class="name">onPressed</span>: <span class="keyword">function</span>() {
             <span class="name">CalcEngine</span>.<span class="name">operatorPressed</span>(<span class="name">text</span>, <span class="name">root</span>.<span class="name">display</span>)
             <span class="name">root</span>.<span class="name">updateDimmed</span>()
         }
         <span class="name">textColor</span>: <span class="string">&quot;#6da43d&quot;</span>
         <span class="name">dimmable</span>: <span class="number">true</span>
     }

     <span class="name">Component</span>.onCompleted: <span class="name">updateDimmed</span>()

     <span class="type">DigitButton</span> {
         <span class="name">text</span>: <span class="string">&quot;7&quot;</span>
     }
     <span class="type">DigitButton</span> {
         <span class="name">text</span>: <span class="string">&quot;8&quot;</span>
     }
     <span class="type">DigitButton</span> {
         <span class="name">text</span>: <span class="string">&quot;9&quot;</span>
     }
     <span class="type">DigitButton</span> {
         <span class="name">text</span>: <span class="string">&quot;4&quot;</span>
     }
     <span class="type">DigitButton</span> {
         <span class="name">text</span>: <span class="string">&quot;5&quot;</span>
     }
     <span class="type">DigitButton</span> {
         <span class="name">text</span>: <span class="string">&quot;6&quot;</span>
     }
     <span class="type">DigitButton</span> {
         <span class="name">text</span>: <span class="string">&quot;1&quot;</span>
     }
     <span class="type">DigitButton</span> {
         <span class="name">text</span>: <span class="string">&quot;2&quot;</span>
     }
     <span class="type">DigitButton</span> {
         <span class="name">text</span>: <span class="string">&quot;3&quot;</span>
     }
     <span class="type">DigitButton</span> {
         <span class="name">text</span>: <span class="string">&quot;0&quot;</span>
     }
     <span class="type">DigitButton</span> {
         <span class="name">text</span>: <span class="string">&quot;.&quot;</span>
         <span class="name">dimmable</span>: <span class="number">true</span>
     }
     <span class="type">DigitButton</span> {
         <span class="name">text</span>: <span class="string">&quot; &quot;</span>
     }
     <span class="type">OperatorButton</span> {
         <span class="name">text</span>: <span class="string">&quot;±&quot;</span>
     }
     <span class="type">OperatorButton</span> {
         <span class="name">text</span>: <span class="string">&quot;−&quot;</span>
     }
     <span class="type">OperatorButton</span> {
         <span class="name">text</span>: <span class="string">&quot;+&quot;</span>
     }
     <span class="type">OperatorButton</span> {
         <span class="name">text</span>: <span class="string">&quot;√&quot;</span>
     }
     <span class="type">OperatorButton</span> {
         <span class="name">text</span>: <span class="string">&quot;÷&quot;</span>
     }
     <span class="type">OperatorButton</span> {
         <span class="name">text</span>: <span class="string">&quot;×&quot;</span>
     }
     <span class="type">OperatorButton</span> {
         <span class="name">text</span>: <span class="string">&quot;C&quot;</span>
     }
     <span class="type">OperatorButton</span> {
         <span class="name">text</span>: <span class="string">&quot; &quot;</span>
     }
     <span class="type">OperatorButton</span> {
         <span class="name">text</span>: <span class="string">&quot;=&quot;</span>
     }
 }
</pre>
<p>Some of the buttons also have a <code translate="no">dimmable</code> property set, meaning that they can be visually disabled (dimmed) whenever the calculator engine does not accept input from that button. As an example, the button for square root operator is dimmed for negative values.</p>
<h4 id="animating-components">Animating Components</h4>
<p>We use the Display type to display calculations. In Display.qml, we use images to make the display component look like a slip of paper that contains a grip. Users can drag the grip to move the display from left to right.</p>
<p>When users release the grip, the <a href="../qtquick/qml-qtquick-animationcontroller.html" translate="no">AnimationController</a> QML type that we define in the calqlatr.qml file finishes running the controlled animation in either a forwards or a backwards direction. To run the animation, we call either completeToEnd() or completeToBeginning(), depending on the direction. We do this in the <a href="../qtquick/qml-qtquick-mousearea.html" translate="no">MouseArea</a>'s <code translate="no">onReleased</code> signal handler, where <code translate="no">controller</code> is the id of our <a href="../qtquick/qml-qtquick-animationcontroller.html" translate="no">AnimationController</a>:</p>
<pre class="cpp" translate="no">
         <span class="type"><a href="../qtquick/qml-qtquick-mousearea.html" translate="no">MouseArea</a></span> {
             ...
             <span class="name">onReleased</span>: {
                 <span class="keyword">if</span> (<span class="name">rewind</span>)
                     <span class="name">controller</span>.<span class="name">completeToBeginning</span>()
                 <span class="keyword">else</span>
                     <span class="name">controller</span>.<span class="name">completeToEnd</span>()
             }
         }
</pre>
<p>Unlike other QML animation types, <a href="../qtquick/qml-qtquick-animationcontroller.html" translate="no">AnimationController</a> is not driven by internal timers but by explicitly setting its progress property to a value between <code translate="no">0.0</code> and <code translate="no">1.0</code>.</p>
<p>Inside the <a href="../qtquick/qml-qtquick-animationcontroller.html" translate="no">AnimationController</a>, we run two <a href="../qtquick/qml-qtquick-numberanimation.html" translate="no">NumberAnimation</a> instances in parallel to move the number pad and the display components simultaneously to the opposite sides of the view. In addition, we run a <a href="../qtquick/qml-qtquick-sequentialanimation.html" translate="no">SequentialAnimation</a> instance to scale the number pad during the transition, giving the animation some depth.</p>
<pre class="cpp" translate="no">
     <span class="type"><a href="../qt3d/qml-qt3d-animation-animationcontroller.html" translate="no">AnimationController</a></span> {
         <span class="name">id</span>: <span class="name">controller</span>
         <span class="name">animation</span>: <span class="name">ParallelAnimation</span> {
             <span class="type"><a href="../qtquick/qml-qtquick-numberanimation.html" translate="no">NumberAnimation</a></span> {
                 <span class="name">target</span>: <span class="name">display</span>
                 <span class="name">property</span>: <span class="string">&quot;x&quot;</span>
                 <span class="name">duration</span>: <span class="number">400</span>
                 <span class="name">from</span>: -<span class="number">16</span>
                 <span class="name">to</span>: <span class="name">window</span>.<span class="name">width</span> <span class="operator">-</span> <span class="name">display</span>.<span class="name">width</span>
                 <span class="name">easing</span>.type: <span class="name">Easing</span>.<span class="name">InOutQuad</span>
             }
             <span class="type"><a href="../qtquick/qml-qtquick-numberanimation.html" translate="no">NumberAnimation</a></span> {
                 <span class="name">target</span>: <span class="name">pad</span>
                 <span class="name">property</span>: <span class="string">&quot;x&quot;</span>
                 <span class="name">duration</span>: <span class="number">400</span>
                 <span class="name">from</span>: <span class="name">window</span>.<span class="name">width</span> <span class="operator">-</span> <span class="name">pad</span>.<span class="name">width</span>
                 <span class="name">to</span>: <span class="number">0</span>
                 <span class="name">easing</span>.type: <span class="name">Easing</span>.<span class="name">InOutQuad</span>
             }
             <span class="type"><a href="../qtquick/qml-qtquick-sequentialanimation.html" translate="no">SequentialAnimation</a></span> {
                 <span class="type"><a href="../qtquick/qml-qtquick-numberanimation.html" translate="no">NumberAnimation</a></span> {
                     <span class="name">target</span>: <span class="name">pad</span>
                     <span class="name">property</span>: <span class="string">&quot;scale&quot;</span>
                     <span class="name">duration</span>: <span class="number">200</span>
                     <span class="name">from</span>: <span class="number">1</span>
                     <span class="name">to</span>: <span class="number">0.97</span>
                     <span class="name">easing</span>.type: <span class="name">Easing</span>.<span class="name">InOutQuad</span>
                 }
                 <span class="type"><a href="../qtquick/qml-qtquick-numberanimation.html" translate="no">NumberAnimation</a></span> {
                     <span class="name">target</span>: <span class="name">pad</span>
                     <span class="name">property</span>: <span class="string">&quot;scale&quot;</span>
                     <span class="name">duration</span>: <span class="number">200</span>
                     <span class="name">from</span>: <span class="number">0.97</span>
                     <span class="name">to</span>: <span class="number">1</span>
                     <span class="name">easing</span>.type: <span class="name">Easing</span>.<span class="name">InOutQuad</span>
                 }
             }
         }
     }
</pre>
<p>We use the easing curve of the type <code translate="no">Easing.InOutQuad</code> to accelerate the motion until halfway and then decelerate it.</p>
<p>In <code translate="no">CalculatorButton.qml</code>, the text colors of the number pad buttons are also animated.</p>
<pre class="cpp" translate="no">
         ...
         <span class="name">color</span>: <span class="name">button</span>.<span class="name">dimmable</span> <span class="operator">&amp;&amp;</span> <span class="name">button</span>.<span class="name">dimmed</span>
             ? <span class="name">Qt</span>.<span class="name">darker</span>(<span class="name">button</span>.<span class="name">textColor</span>)
             : (<span class="name">button</span>.<span class="name">pressed</span> ? <span class="name">Qt</span>.<span class="name">lighter</span>(<span class="name">button</span>.<span class="name">textColor</span>) : <span class="name">button</span>.<span class="name">textColor</span>)
         Behavior on <span class="name">color</span> {
             <span class="type"><a href="../qtquick/qml-qtquick-coloranimation.html" translate="no">ColorAnimation</a></span> {
                 <span class="name">duration</span>: <span class="number">120</span>
                 <span class="name">easing</span>.type: <span class="name">Easing</span>.<span class="name">OutElastic</span>
             }
         }
</pre>
<p>We use <a href="../qtqml/qml-qtqml-qt.html#darker-method" translate="no">Qt.darker</a>() to darken the color when the button is dimmed, and <a href="../qtqml/qml-qtqml-qt.html#lighter-method" translate="no">Qt.lighter</a>() to <i>light up</i> the button when pressed. The latter is done in a separate <a href="../qtquick/qml-qtquick-state.html" translate="no">state</a> called <i>&quot;pressed&quot;</i>, which activates when the <code translate="no">pressed</code> property of the button's <a href="../qtquick/qml-qtquick-mousearea.html" translate="no">MouseArea</a> is set.</p>
<p>The color changes are animated by defining a <a href="../qtquick/qml-qtquick-behavior.html" translate="no">Behavior</a> on the <code translate="no">color</code> property.</p>
<p>In order to dynamically change the <code translate="no">dimmed</code> property of all the buttons of the <code translate="no">NumberPad</code>, we connect its <code translate="no">buttonPressed</code> signal to the <code translate="no">NumberPad</code>'s <code translate="no">updateDimmed()</code> function.</p>
<pre class="cpp" translate="no">
     <span class="keyword">function </span><span class="name">updateDimmed</span>() {
         <span class="keyword">for</span> (let i = 0; <span class="name">i</span> <span class="operator">&lt;</span> <span class="name">children</span>.<span class="name">length</span>; i++) {
             <span class="name">children</span>[<span class="name">i</span>].<span class="name">dimmed</span> <span class="operator">=</span> <span class="name">CalcEngine</span>.<span class="name">isOperationDisabled</span>(<span class="name">children</span>[<span class="name">i</span>].<span class="name">text</span>)
         }
     }

     component DigitButton: <span class="type">CalculatorButton</span> {
         <span class="name">onPressed</span>: <span class="keyword">function</span>() {
             <span class="name">CalcEngine</span>.<span class="name">digitPressed</span>(<span class="name">text</span>, <span class="name">root</span>.<span class="name">display</span>)
             <span class="name">root</span>.<span class="name">updateDimmed</span>()
         }
     }

     component OperatorButton: <span class="type">CalculatorButton</span> {
         <span class="name">onPressed</span>: <span class="keyword">function</span>() {
             <span class="name">CalcEngine</span>.<span class="name">operatorPressed</span>(<span class="name">text</span>, <span class="name">root</span>.<span class="name">display</span>)
             <span class="name">root</span>.<span class="name">updateDimmed</span>()
         }
         <span class="name">textColor</span>: <span class="string">&quot;#6da43d&quot;</span>
         <span class="name">dimmable</span>: <span class="number">true</span>
     }
</pre>
<p>This way, when a button is pressed, all buttons on the <code translate="no">NumPad</code> receive a <code translate="no">buttonPressed</code> signal and are activated or deactivated according to the state of the calculator engine.</p>
<h4 id="performing-calculations">Performing Calculations</h4>
<p>The calculator.js file defines our calculator engine. It contains variables to store the calculator state, and functions that are called when the user presses the digit and operator buttons. To use the engine, we import calculator.js in the calqlatr.qml file as <code translate="no">CalcEngine</code>:</p>
<pre class="cpp" translate="no">
 import <span class="string">&quot;content/calculator.js&quot;</span> as CalcEngine
</pre>
<p>By default, <a href="../qtqml/qtqml-javascript-resources.html" translate="no">importing a JavaScript file from QML creates a new instance of it</a>, and any state it contains is unique to that instance. For this example we want the state to be shared amongst all users of the script, so we use <code translate="no">.pragma library</code> to indicate that:</p>
<pre class="cpp" translate="no">
 .pragma library
</pre>
<p>When users press a digit, the text from the digit appears on the display. When they press an operator, the appropriate calculation is performed, and the result can be displayed using the equals (=) operator. The clear (C) operator resets the calculator engine.</p>
<pre class="cpp" translate="no">
 function isOperationDisabled(op) {
     if (digits === &quot;&quot; &amp;&amp; !((op &gt;= &quot;0&quot; &amp;&amp; op &lt;= &quot;9&quot;) || op === &quot;.&quot;))
         return true
     else if (op === '=' &amp;&amp; previousOperator.length !== 1)
         return true
     else if (op === &quot;.&quot; &amp;&amp; digits.toString().search(/\./) !== -1) {
         return true
     } else if (op === &quot;√&quot; &amp;&amp;  digits.toString().search(/-/) !== -1) {
         return true
     } else {
         return false
     }
 }

 function digitPressed(op, display) {
     if (isOperationDisabled(op))
         return
     if (digits.toString().length &gt;= display.maxDigits)
         return
     if (lastOp.toString().length === 1 &amp;&amp; ((lastOp &gt;= &quot;0&quot; &amp;&amp; lastOp &lt;= &quot;9&quot;) || lastOp === &quot;.&quot;) ) {
         digits = digits + op.toString()
         display.appendDigit(op.toString())
     } else {
         digits = op
         display.appendDigit(op.toString())
     }
     lastOp = op
 }

 function operatorPressed(op, display) {
     if (isOperationDisabled(op))
         return
     lastOp = op

     if (op === &quot;±&quot;) {
             digits = Number(digits.valueOf() * -1)
             display.setDigit(display.displayNumber(digits))
             return
         }

     if (previousOperator === &quot;+&quot;) {
         digits = Number(digits.valueOf()) + Number(curVal.valueOf())
     } else if (previousOperator === &quot;−&quot;) {
         digits = Number(curVal.valueOf()) - Number(digits.valueOf())
     } else if (previousOperator === &quot;×&quot;) {
         digits = Number(curVal) * Number(digits.valueOf())
     } else if (previousOperator === &quot;÷&quot;) {
         digits = Number(curVal) / Number(digits.valueOf())
     }

     if (op === &quot;+&quot; || op === &quot;−&quot; || op === &quot;×&quot; || op === &quot;÷&quot;) {
         previousOperator = op
         curVal = digits.valueOf()
         digits = &quot;&quot;
         display.displayOperator(previousOperator)
         return
     }

     if (op === &quot;=&quot;) {
         display.newLine(&quot;=&quot;, digits.valueOf())
     }
</pre>
<h4 id="list-of-files">List of Files</h4>
<p><a href="https://code.qt.io/cgit/qt/qtdoc.git/tree/examples/demos/calqlatr?h=6.6" translate="no">Example project @ code.qt.io</a></p>
</div>
<p><b>See also </b><a href="qmlapplications.html" translate="no">QML Applications</a>.</p>
<!-- @@@demos/calqlatr -->
        </div>
       </div>
   </div>
   </div>
</div>
<div class="footer">
   <p>
   <acronym title="Copyright">&copy;</acronym> 2024 <span translate="no">The Qt Company Ltd.</span>
   Documentation contributions included herein are the copyrights of
   their respective owners.<br/>    The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the <span translate="no">Free Software Foundation</span>.<br/>    <span translate="no">Qt</span> and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of <span translate="no">The Qt Company Ltd.</span> in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>
</div>
</body>
</html>
