<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<!-- qt6-changes.qdoc -->
  <meta name="description" content="Migrate Qt Positioning to Qt 6.">
  <title>Changes to Qt Positioning | Qt Positioning 6.6.2</title>
  <link rel="stylesheet" type="text/css" href="style/offline-simple.css" />
  <script type="text/javascript">
    document.getElementsByTagName("link").item(0).setAttribute("href", "style/offline.css");
    // loading style sheet breaks anchors that were jumped to before
    // so force jumping to anchor again
    setTimeout(function() {
        var anchor = location.hash;
        // need to jump to different anchor first (e.g. none)
        location.hash = "#";
        setTimeout(function() {
            location.hash = anchor;
        }, 0);
    }, 0);
  </script>
</head>
<body>
<div class="header" id="qtdocheader">
    <div class="main">
    <div class="main-rounded">
        <div class="navigationbar">
        <ul>
<li><a href="../qtdoc/index.html" translate="no">Qt 6.6</a></li>
<li><a href="qtpositioning-index.html" translate="no">Qt Positioning</a></li>
<li>Changes to Qt Positioning</li>
<li id="buildversion"><a href="qtpositioning-index.html" translate="no">Qt 6.6.2 Reference Documentation</a></li>
    </ul>
    </div>
</div>
<div class="content">
<div class="line">
<div class="content mainContent">
<div class="sidebar">
<div class="toc">
<h3 id="toc">Contents</h3>
<ul>
<li class="level1"><a href="#breaking-public-api-changes">Breaking public API changes</a></li>
<li class="level2"><a href="#rename-qgeopolygon-path">Rename QGeoPolygon::path()</a></li>
<li class="level2"><a href="#use-qgeoshape-for-qgeolocation-bounding-area">Use QGeoShape for QGeoLocation bounding area</a></li>
<li class="level2"><a href="#remove-qgeoshape-extendshape">Remove QGeoShape::extendShape()</a></li>
<li class="level2"><a href="#rename-signal-error-to-erroroccurred">Rename signal error to errorOccurred</a></li>
<li class="level2"><a href="#remove-update-timeout-signals">Remove update timeout signals</a></li>
<li class="level2"><a href="#redesign-nmea-support">Redesign NMEA support</a></li>
<li class="level1"><a href="#other-api-changes">Other API changes</a></li>
<li class="level2"><a href="#reset-errors-properly">Reset errors properly</a></li>
<li class="level2"><a href="#add-qgeoaddress-streetnumber">Add QGeoAddress::streetNumber</a></li>
<li class="level2"><a href="#add-timeout-argument-to-positionsource-update">Add timeout argument to PositionSource::update()</a></li>
<li class="level2"><a href="#refactor-qgeosatelliteinfo-qgeopositioninfo-and-qgeoareamonitorinfo-classes">Refactor QGeoSatelliteInfo, QGeoPositionInfo and QGeoAreaMonitorInfo classes</a></li>
<li class="level1"><a href="#changes-in-qt-positioning-plugin-implementation">Changes in Qt Positioning plugin implementation</a></li>
</ul>
</div>
<div class="sidebar-content" id="sidebar-content"></div></div>
<h1 class="title">Changes to Qt Positioning</h1>
<!-- $$$qtpositioning-changes-qt6.html-description -->
<div class="descr" id="details">
<p>Qt 6 is a result of the conscious effort to make the framework more efficient and easy to use.</p>
<p>We try to maintain binary and source compatibility for all the public APIs in each release. But some changes were inevitable in an effort to make Qt a better framework.</p>
<p>In this topic we summarize those changes in Qt Positioning, and provide guidance to handle them.</p>
<h2 id="breaking-public-api-changes">Breaking public API changes</h2>
<p>This section contains information about API changes that break source compatibility.</p>
<h3 id="rename-qgeopolygon-path">Rename QGeoPolygon::path()</h3>
<p>The <code translate="no">QGeoPolygon::path()</code> and <code translate="no">QGeoPolygon::setPath()</code> methods are renamed to <a href="qgeopolygon.html#perimeter" translate="no">QGeoPolygon::perimeter</a>() and <a href="qgeopolygon.html#setPerimeter" translate="no">QGeoPolygon::setPerimeter</a>() respectively. On the QML side the <a href="qgeopolygon.html#perimeter" translate="no">QGeoPolygon::perimeter</a> property can be used without any changes.</p>
<h3 id="use-qgeoshape-for-qgeolocation-bounding-area">Use <a href="qgeoshape.html" translate="no">QGeoShape</a> for <a href="qgeolocation.html" translate="no">QGeoLocation</a> bounding area</h3>
<p>The <a href="qgeolocation.html" translate="no">QGeoLocation</a> class and its <a href="qml-qtpositioning-location.html" translate="no">Location</a> QML counterpart are updated to use <a href="qgeoshape.html" translate="no">QGeoShape</a> instead of <a href="qgeorectangle.html" translate="no">QGeoRectangle</a> for a bounding area.</p>
<h4 id="c">C++</h4>
<p>The <code translate="no">QGeoLocation::boundingBox()</code> and <code translate="no">QGeoLocation::setBoundingBox()</code> are replaced by <a href="qgeolocation.html#boundingShape" translate="no">QGeoLocation::boundingShape</a>() and <a href="qgeolocation.html#setBoundingShape" translate="no">QGeoLocation::setBoundingShape</a>() respectively. A <a href="qgeoshape.html" translate="no">QGeoShape</a> object is now used as an underlying data storage.</p>
<h4 id="qml">QML</h4>
<p>The <code translate="no">QGeoLocation::boundingBox</code> property is replaced by <a href="qgeolocation.html#boundingShape" translate="no">QGeoLocation::boundingShape</a>. This property is available since <a href="qml-qtpositioning-qtpositioning.html" translate="no">QtPositioning</a> 6.2, so make sure to update the import version in the QML files.</p>
<pre class="cpp" translate="no">
 import <span class="type"><a href="qml-qtpositioning-qtpositioning.html" translate="no">QtPositioning</a></span> <span class="number">6.2</span>
</pre>
<h3 id="remove-qgeoshape-extendshape">Remove QGeoShape::extendShape()</h3>
<p>The <code translate="no">QGeoShape::extendShape()</code> method was deprecated in Qt 5.9 and finally removed in Qt 6. Use <a href="qgeorectangle.html#extendRectangle" translate="no">QGeoRectangle::extendRectangle</a>() and <a href="qgeocircle.html#extendCircle" translate="no">QGeoCircle::extendCircle</a>() if you need this functionality for these classes.</p>
<h3 id="rename-signal-error-to-erroroccurred">Rename signal error to errorOccurred</h3>
<p>In Qt 5 multiple Qt Positioning classes had the <code translate="no">error()</code> signal, which was clashing with the <code translate="no">error()</code> method. In Qt 6 we renamed these signals to <code translate="no">errorOccurred()</code>. Specifically:</p>
<ul>
<li><code translate="no">QGeoAreaMonitorSource::error()</code> is renamed to <a href="qgeoareamonitorsource.html#errorOccurred" translate="no">QGeoAreaMonitorSource::errorOccurred</a>().</li>
<li><code translate="no">QGeoPositionInfoSource::error()</code> is renamed to <a href="qgeopositioninfosource.html#errorOccurred" translate="no">QGeoPositionInfoSource::errorOccurred</a>().</li>
<li><code translate="no">QGeoSatelliteInfoSource::error()</code> is renamed to <a href="qgeosatelliteinfosource.html#errorOccurred" translate="no">QGeoSatelliteInfoSource::errorOccurred</a>().</li>
</ul>
<h3 id="remove-update-timeout-signals">Remove update timeout signals</h3>
<p>In Qt 5 <code translate="no">QGeoPositionInfoSource::updateTimeout()</code> and <code translate="no">QGeoSatelliteInfoSource::requestTimeout()</code> signals were used to notify about the cases when the current position or satellite information could not be retrieved within specified timeout. These signals were removed in Qt 6. The <code translate="no">errorOccurred()</code> signals with the new error types are used instead. Specifically:</p>
<ul>
<li><a href="qgeopositioninfosource.html" translate="no">QGeoPositionInfoSource</a> uses an <a href="qgeopositioninfosource.html#errorOccurred" translate="no">errorOccurred</a>() signal with a new <a href="qgeopositioninfosource.html#Error-enum" translate="no">QGeoPositionInfoSource::UpdateTimeoutError</a> error code.</li>
<li><a href="qgeosatelliteinfosource.html" translate="no">QGeoSatelliteInfoSource</a> uses an <a href="qgeosatelliteinfosource.html#errorOccurred" translate="no">errorOccurred</a>() signal with a new <a href="qgeosatelliteinfosource.html#Error-enum" translate="no">QGeoSatelliteInfoSource::UpdateTimeoutError</a> error code.</li>
</ul>
<p>Same changes apply to <a href="qml-qtpositioning-positionsource.html" translate="no">PositionSource</a> QML object. The <code translate="no">PositionSource::updateTimeout()</code> signal is removed. <a href="qml-qtpositioning-positionsource.html#sourceError-prop" translate="no">PositionSource::sourceError</a> property with a <code translate="no">PositionSource.UpdateTimeoutError</code> is used instead.</p>
<h3 id="redesign-nmea-support">Redesign NMEA support</h3>
<p>In Qt 5 we had a <b>serialnmea</b> positioning plugin and a <code translate="no">nmeaSource</code> property in <a href="qml-qtpositioning-positionsource.html" translate="no">PositionSource</a> object.</p>
<p>The plugin provided access to NMEA streams via serial port, while the QML object was responsible for reading NMEA stream from TCP socket or local file.</p>
<p>In Qt 6 we joined all these features in the plugin, which is now renamed to <b>nmea</b>. It is now capable of working with all three NMEA data sources: serial port, TCP socket and local file. See <a href="position-plugin-nmea.html" translate="no">plugin description</a> for more details.</p>
<p>The <code translate="no">nmeaSource</code> property of <a href="qml-qtpositioning-positionsource.html" translate="no">PositionSource</a> object is now removed.</p>
<h2 id="other-api-changes">Other API changes</h2>
<p>This section contains API improvements that do not break source compatibility. However they might have an impact on the application logic, so it is still useful to know about them.</p>
<h3 id="reset-errors-properly">Reset errors properly</h3>
<p>In Qt 5 the errors for <a href="qgeoareamonitorsource.html" translate="no">QGeoAreaMonitorSource</a>, <a href="qgeopositioninfosource.html" translate="no">QGeoPositionInfoSource</a> and <a href="qgeosatelliteinfosource.html" translate="no">QGeoSatelliteInfoSource</a> classes were never reset. This behavior is not logical, as calling <code translate="no">startUpdates()</code>, <code translate="no">startMonitoring()</code> or <code translate="no">requestUpdates()</code> on one of these classes or their subclasses effectively means starting a new work sessions, which means that we should not care about previous errors. Since Qt 6 we reset the error to <code translate="no">NoError</code> once one of the aforementioned methods is called.</p>
<h3 id="add-qgeoaddress-streetnumber">Add <a href="qgeoaddress.html#streetNumber" translate="no">QGeoAddress::streetNumber</a></h3>
<p>The <a href="qgeoaddress.html" translate="no">QGeoAddress</a> class is extended with <a href="qgeoaddress.html#streetNumber" translate="no">streetNumber</a> property, which holds the information about street number, building name, or anything else that might be used to distinguish one address from another. Use <a href="qgeoaddress.html#streetNumber" translate="no">streetNumber</a>() and <a href="qgeoaddress.html#setStreetNumber" translate="no">setStreetNumber</a>() to access this property from C++ code.</p>
<p>The <a href="qgeoaddress.html#street" translate="no">QGeoAddress::street</a> now holds only the street name.</p>
<p>Same applies to <a href="qml-qtpositioning-address.html" translate="no">Address</a> QML counterpart. The <a href="qml-qtpositioning-address.html#street-prop" translate="no">Address::street</a> property is now used only for street name, while the <a href="qml-qtpositioning-address.html#streetNumber-prop" translate="no">Address::streetNumber</a> property is used for other important address details.</p>
<h3 id="add-timeout-argument-to-positionsource-update">Add timeout argument to <a href="qml-qtpositioning-positionsource.html#update-method" translate="no">PositionSource::update()</a></h3>
<p>The <code translate="no">timeout</code> is specified in milliseconds. If the <code translate="no">timeout</code> is zero (the default value), it defaults to a reasonable timeout period as appropriate for the source.</p>
<h3 id="refactor-qgeosatelliteinfo-qgeopositioninfo-and-qgeoareamonitorinfo-classes">Refactor <a href="qgeosatelliteinfo.html" translate="no">QGeoSatelliteInfo</a>, <a href="qgeopositioninfo.html" translate="no">QGeoPositionInfo</a> and <a href="qgeoareamonitorinfo.html" translate="no">QGeoAreaMonitorInfo</a> classes</h3>
<p>These classes now use <a href="../qtcore/qexplicitlyshareddatapointer.html" translate="no">QExplicitlySharedDataPointer</a> in their implementation. It means that the classes implement copy-on-write. It makes them cheap to copy, so that they can be passed by value.</p>
<p>Another improvement is the addition of support for the efficient move operations.</p>
<h2 id="changes-in-qt-positioning-plugin-implementation">Changes in Qt Positioning plugin implementation</h2>
<p>This section provides information about the changes in plugin interface.</p>
<p>In Qt 5 for we had two versions of plugin interface:</p>
<ul>
<li><code translate="no">QGeoPositionInfoSourceFactory</code> which provided the basic features.</li>
<li><code translate="no">QGeoPositionInfoSourceFactoryV2</code> which extended the base class with the possibility to provide custom parameters for the created objects.</li>
</ul>
<p>In Qt 6 we merged these two implementations into one, leaving only the <a href="qgeopositioninfosourcefactory.html" translate="no">QGeoPositionInfoSourceFactory</a> class. Its methods now allow to pass custom parameters.</p>
<div class="admonition note">
<p><b>Note: </b>The interface <i>identifier</i> is updated to reflect the major version update. Use <code translate="no">&quot;org.qt-project.qt.position.sourcefactory/6.0&quot;</code> in your Qt Positioning plugins.</p>
</div>
<p>Here is an example of plugin class declaration:</p>
<pre class="cpp" translate="no">
 <span class="keyword">class</span> MyPlugin : <span class="keyword">public</span> <span class="type"><a href="../qtcore/qobject.html" translate="no">QObject</a></span><span class="operator">,</span> <span class="keyword">public</span> <span class="type"><a href="qgeopositioninfosourcefactory.html" translate="no">QGeoPositionInfoSourceFactory</a></span>
 {
     Q_OBJECT
     Q_PLUGIN_METADATA(IID <span class="string">&quot;org.qt-project.qt.position.sourcefactory/6.0&quot;</span>
                       FILE <span class="string">&quot;plugin.json&quot;</span>)
     Q_INTERFACES(<span class="type"><a href="qgeopositioninfosourcefactory.html" translate="no">QGeoPositionInfoSourceFactory</a></span>)

 <span class="keyword">public</span>:
     <span class="type"><a href="qgeopositioninfosource.html" translate="no">QGeoPositionInfoSource</a></span> <span class="operator">*</span>positionInfoSource(<span class="type"><a href="../qtcore/qobject.html" translate="no">QObject</a></span> <span class="operator">*</span>parent<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="../qtcore/qvariant.html#QVariantMap-typedef" translate="no">QVariantMap</a></span> <span class="operator">&amp;</span>parameters) override;
     <span class="type"><a href="qgeosatelliteinfosource.html" translate="no">QGeoSatelliteInfoSource</a></span> <span class="operator">*</span>satelliteInfoSource(<span class="type"><a href="../qtcore/qobject.html" translate="no">QObject</a></span> <span class="operator">*</span>parent<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="../qtcore/qvariant.html#QVariantMap-typedef" translate="no">QVariantMap</a></span> <span class="operator">&amp;</span>parameters) override;
     <span class="type"><a href="qgeoareamonitorsource.html" translate="no">QGeoAreaMonitorSource</a></span> <span class="operator">*</span>areaMonitor(<span class="type"><a href="../qtcore/qobject.html" translate="no">QObject</a></span> <span class="operator">*</span>parent<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="../qtcore/qvariant.html#QVariantMap-typedef" translate="no">QVariantMap</a></span> <span class="operator">&amp;</span>parameters) override;
 };
</pre>
</div>
<!-- @@@qtpositioning-changes-qt6.html -->
        </div>
       </div>
   </div>
   </div>
</div>
<div class="footer">
   <p>
   <acronym title="Copyright">&copy;</acronym> 2024 <span translate="no">The Qt Company Ltd.</span>
   Documentation contributions included herein are the copyrights of
   their respective owners.<br/>    The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the <span translate="no">Free Software Foundation</span>.<br/>    <span translate="no">Qt</span> and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of <span translate="no">The Qt Company Ltd.</span> in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>
</div>
</body>
</html>
